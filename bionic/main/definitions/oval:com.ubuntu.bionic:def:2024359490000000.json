{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.bionic:def:2024359490000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-35949 on Ubuntu 18.04 LTS (bionic) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved: btrfs:make sure that WRITTEN is set on all metadata blocks We previously wouldcall btrfs_check_leaf() if we had the check integrity code enabled, whichmeant that we could only run the extended leaf checks if we had WRITTEN seton the header flags. This leaves a gap in our checking, because we couldend up with corruption on disk where WRITTEN isn't set on the leaf, andthen the extended leaf checks don't get run which we rely on to validateall of the item pointers to make sure we don't access memory outside of theextent buffer. However, since 732fab95abe2 (\"btrfs: check-integrity: removeCONFIG_BTRFS_FS_CHECK_INTEGRITY option\") we no longer callbtrfs_check_leaf() from btrfs_mark_buffer_dirty(), which means we only evercall it on blocks that are being written out, and thus have WRITTEN set, orthat are being read in, which should have WRITTEN set. Add checks to makesure we have WRITTEN set appropriately, and then make sure__btrfs_check_leaf() always does the item checking. This will protect usfrom file systems that have been corrupted and no longer have WRITTEN seton some of the blocks. This was hit on a crafted image tweaking the WRITTENbit and reported by KASAN as out-of-bound access in the eb accessors. Theexample is a dir item at the end of an eb. [2.042] BTRFS warning (deviceloop1): bad eb member start: ptr 0x3fff start 30572544 member offset 16410size 2 [2.040] general protection fault, probably for non-canonical address0xe0009d1000000003: 0000 [#1] PREEMPT SMP KASAN NOPTI [2.537] KASAN: maybewild-memory-access in range [0x0005088000000018-0x000508800000001f] [2.729]CPU: 0 PID: 2587 Comm: mount Not tainted 6.8.2 #1 [2.729] Hardware name:QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014 [2.621]RIP: 0010:btrfs_get_16+0x34b/0x6d0 [2.621] RSP: 0018:ffff88810871fab8EFLAGS: 00000206 [2.621] RAX: 0000a11000000003 RBX: ffff888104ff8720 RCX:ffff88811b2288c0 [2.621] RDX: dffffc0000000000 RSI: ffffffff81dd8aca RDI:ffff88810871f748 [2.621] RBP: 000000000000401a R08: 0000000000000001 R09:ffffed10210e3ee9 [2.621] R10: ffff88810871f74f R11: 205d323430333737 R12:000000000000001a [2.621] R13: 000508800000001a R14: 1ffff110210e3f5d R15:ffffffff850011e8 [2.621] FS: 00007f56ea275840(0000)GS:ffff88811b200000(0000) knlGS:0000000000000000 [2.621] CS: 0010 DS: 0000ES: 0000 CR0: 0000000080050033 [2.621] CR2: 00007febd13b75c0 CR3:000000010bb50000 CR4: 00000000000006f0 [2.621] Call Trace: [2.621] <TASK>[2.621] ? show_regs+0x74/0x80 [2.621] ? die_addr+0x46/0xc0 [2.621] ?exc_general_protection+0x161/0x2a0 [2.621] ?asm_exc_general_protection+0x26/0x30 [2.621] ? btrfs_get_16+0x33a/0x6d0[2.621] ? btrfs_get_16+0x34b/0x6d0 [2.621] ? btrfs_get_16+0x33a/0x6d0[2.621] ? __pfx_btrfs_get_16+0x10/0x10 [2.621] ?__pfx_mutex_unlock+0x10/0x10 [2.621] btrfs_match_dir_item_name+0x101/0x1a0[2.621] btrfs_lookup_dir_item+0x1f3/0x280 [2.621] ?__pfx_btrfs_lookup_dir_item+0x10/0x10 [2.621] btrfs_get_tree+0xd25/0x1910 [copy more details from report ]",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 18.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-35949",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2024-35949"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-05-20 10:15:00 UTC",
			"cve": {
				"text": "CVE-2024-35949",
				"href": "https://ubuntu.com/security/CVE-2024-35949",
				"public": "20240520"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000000",
						"comment": "linux package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000040",
						"comment": "linux-hwe: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000220",
						"comment": "linux-hwe-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000090",
						"comment": "linux-kvm package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000030",
						"comment": "linux-aws package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000150",
						"comment": "linux-aws-5.0: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000200",
						"comment": "linux-aws-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000270",
						"comment": "linux-aws-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000070",
						"comment": "linux-azure: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000190",
						"comment": "linux-azure-4.15 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201585530000000",
						"comment": "linux-azure-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000240",
						"comment": "linux-azure-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000080",
						"comment": "linux-gcp: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000210",
						"comment": "linux-gcp-4.15 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000130",
						"comment": "linux-gcp-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000260",
						"comment": "linux-gcp-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000050",
						"comment": "linux-gke-4.15: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gke-5.0')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000280",
						"comment": "linux-gke-5.4: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000290",
						"comment": "linux-gkeop-5.4: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000310",
						"comment": "linux-ibm-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000110",
						"comment": "linux-oracle package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000140",
						"comment": "linux-oracle-5.0: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000180",
						"comment": "linux-oracle-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000250",
						"comment": "linux-oracle-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000100",
						"comment": "linux-oem: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000230",
						"comment": "linux-raspi-5.4 package in bionic is affected and may need fixing."
					}
				]
			}
		]
	}
}

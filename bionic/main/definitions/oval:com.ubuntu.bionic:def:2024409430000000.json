{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.bionic:def:2024409430000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-40943 on Ubuntu 18.04 LTS (bionic) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:ocfs2: fix races between hole punching and AIO+DIOAfter commit \"ocfs2: return real error code in ocfs2_dio_wr_get_block\",fstests/generic/300 become from always failed to sometimes failed:========================================================================[  473.293420 ] run fstests generic/300[  475.296983 ] JBD2: Ignoring recovery information on journal[  475.302473 ] ocfs2: Mounting device (253,1) on (node local, slot 0) withordered data mode.[  494.290998 ] OCFS2: ERROR (device dm-1): ocfs2_change_extent_flag: Owner5668 has an extent at cpos 78723 which can no longer be found[  494.291609 ] On-disk corruption discovered. Please run fsck.ocfs2 oncethe filesystem is unmounted.[  494.292018 ] OCFS2: File system is now read-only.[  494.292224 ] (kworker/19:11,2628,19):ocfs2_mark_extent_written:5272ERROR: status = -30[  494.292602 ] (kworker/19:11,2628,19):ocfs2_dio_end_io_write:2374 ERROR:status = -3fio: io_u error on file /mnt/scratch/racer: Read-only file system: writeoffset=460849152, buflen=131072=========================================================================In __blockdev_direct_IO, ocfs2_dio_wr_get_block is called to add unwrittenextents to a list.  extents are also inserted into extent tree inocfs2_write_begin_nolock.  Then another thread call fallocate to puch ahole at one of the unwritten extent.  The extent at cpos was removed byocfs2_remove_extent().  At end io worker thread, ocfs2_search_extent_listfound there is no such extent at the cpos.    T1                        T2                T3                              inode lock                                ...                                insert extents                                ...                              inode unlockocfs2_fallocate __ocfs2_change_file_space  inode lock  lock ip_alloc_sem  ocfs2_remove_inode_range inode   ocfs2_remove_btree_range    ocfs2_remove_extent    ^---remove the extent at cpos 78723  ...  unlock ip_alloc_sem  inode unlock                                       ocfs2_dio_end_io                                        ocfs2_dio_end_io_write                                         lock ip_alloc_sem                                         ocfs2_mark_extent_written                                          ocfs2_change_extent_flag                                           ocfs2_search_extent_list                                           ^---failed to find extent                                          ...                                          unlock ip_alloc_semIn most filesystems, fallocate is not compatible with racing with AIO+DIO,so fix it by adding to wait for all dio before fallocate/punch_hole likeext4.",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 18.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-40943",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2024-40943"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-07-15",
			"cve": {
				"text": "CVE-2024-40943",
				"href": "https://ubuntu.com/security/CVE-2024-40943",
				"public": "20240715"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000000",
						"comment": "linux package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000040",
						"comment": "linux-hwe: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000220",
						"comment": "linux-hwe-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000090",
						"comment": "linux-kvm package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000030",
						"comment": "linux-aws package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000150",
						"comment": "linux-aws-5.0: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000200",
						"comment": "linux-aws-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000270",
						"comment": "linux-aws-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000070",
						"comment": "linux-azure: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000190",
						"comment": "linux-azure-4.15 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201585530000000",
						"comment": "linux-azure-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000240",
						"comment": "linux-azure-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000080",
						"comment": "linux-gcp: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000210",
						"comment": "linux-gcp-4.15 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000130",
						"comment": "linux-gcp-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000260",
						"comment": "linux-gcp-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000050",
						"comment": "linux-gke-4.15: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gke-5.0')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000280",
						"comment": "linux-gke-5.4: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000290",
						"comment": "linux-gkeop-5.4: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000310",
						"comment": "linux-ibm-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000110",
						"comment": "linux-oracle package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000140",
						"comment": "linux-oracle-5.0: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000180",
						"comment": "linux-oracle-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000250",
						"comment": "linux-oracle-5.4 package in bionic is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000100",
						"comment": "linux-oem: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000230",
						"comment": "linux-raspi-5.4 package in bionic is affected and may need fixing."
					}
				]
			}
		]
	}
}

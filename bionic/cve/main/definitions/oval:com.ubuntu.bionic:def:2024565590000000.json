{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.bionic:def:2024565590000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-56559 on Ubuntu 18.04 LTS (bionic) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:mm/vmalloc: combine all TLB flush operations of KASAN shadow virtualaddress into one operationWhen compiling kernel source 'make -j $(nproc)' with the up-and-runningKASAN-enabled kernel on a 256-core machine, the following soft lockup isshown:watchdog: BUG: soft lockup - CPU#28 stuck for 22s! [kworker/28:1:1760]CPU: 28 PID: 1760 Comm: kworker/28:1 Kdump: loaded Not tainted 6.10.0-rc5#95Workqueue: events drain_vmap_area_workRIP: 0010:smp_call_function_many_cond+0x1d8/0xbb0Code: 38 c8 7c 08 84 c9 0f 85 49 08 00 00 8b 45 08 a8 01 74 2e 48 89 f1 4989 f7 48 c1 e9 03 41 83 e7 07 4c 01 e9 41 83 c7 03 f3 90 <0f> b6 01 41 38c7 7c 08 84 c0 0f 85 d4 06 00 00 8b 45 08 a8 01 75RSP: 0018:ffffc9000cb3fb60 EFLAGS: 00000202RAX: 0000000000000011 RBX: ffff8883bc4469c0 RCX: ffffed10776e9949RDX: 0000000000000002 RSI: ffff8883bb74ca48 RDI: ffffffff8434dc50RBP: ffff8883bb74ca40 R08: ffff888103585dc0 R09: ffff8884533a1800R10: 0000000000000004 R11: ffffffffffffffff R12: ffffed1077888d39R13: dffffc0000000000 R14: ffffed1077888d38 R15: 0000000000000003FS:  0000000000000000(0000) GS:ffff8883bc400000(0000)knlGS:0000000000000000CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033CR2: 00005577b5c8d158 CR3: 0000000004850000 CR4: 0000000000350ef0Call Trace: <IRQ> ? watchdog_timer_fn+0x2cd/0x390 ? __pfx_watchdog_timer_fn+0x10/0x10 ? __hrtimer_run_queues+0x300/0x6d0 ? sched_clock_cpu+0x69/0x4e0 ? __pfx___hrtimer_run_queues+0x10/0x10 ? srso_return_thunk+0x5/0x5f ? ktime_get_update_offsets_now+0x7f/0x2a0 ? srso_return_thunk+0x5/0x5f ? srso_return_thunk+0x5/0x5f ? hrtimer_interrupt+0x2ca/0x760 ? __sysvec_apic_timer_interrupt+0x8c/0x2b0 ? sysvec_apic_timer_interrupt+0x6a/0x90 </IRQ> <TASK> ? asm_sysvec_apic_timer_interrupt+0x16/0x20 ? smp_call_function_many_cond+0x1d8/0xbb0 ? __pfx_do_kernel_range_flush+0x10/0x10 on_each_cpu_cond_mask+0x20/0x40 flush_tlb_kernel_range+0x19b/0x250 ? srso_return_thunk+0x5/0x5f ? kasan_release_vmalloc+0xa7/0xc0 purge_vmap_node+0x357/0x820 ? __pfx_purge_vmap_node+0x10/0x10 __purge_vmap_area_lazy+0x5b8/0xa10 drain_vmap_area_work+0x21/0x30 process_one_work+0x661/0x10b0 worker_thread+0x844/0x10e0 ? srso_return_thunk+0x5/0x5f ? __kthread_parkme+0x82/0x140 ? __pfx_worker_thread+0x10/0x10 kthread+0x2a5/0x370 ? __pfx_kthread+0x10/0x10 ret_from_fork+0x30/0x70 ? __pfx_kthread+0x10/0x10 ret_from_fork_asm+0x1a/0x30 </TASK>Debugging Analysis:  1. The following ftrace log shows that the lockup CPU spends too much     time iterating vmap_nodes and flushing TLB when purging vm_area     structures. (Some info is trimmed).     kworker: funcgraph_entry:              |  drain_vmap_area_work() {     kworker: funcgraph_entry:              |   mutex_lock() {     kworker: funcgraph_entry:  1.092 us    |     __cond_resched();     kworker: funcgraph_exit:   3.306 us    |   }     ...                                        ...     kworker: funcgraph_entry:              |    flush_tlb_kernel_range() {     ...                                          ...     kworker: funcgraph_exit: # 7533.649 us |    }     ...                                         ...     kworker: funcgraph_entry:  2.344 us    |   mutex_unlock();     kworker: funcgraph_exit: $ 23871554 us | }     The drain_vmap_area_work() spends over 23 seconds.     There are 2805 flush_tlb_kernel_range() calls in the ftrace log.       * One is called in __purge_vmap_area_lazy().       * Others are called by purge_vmap_node->kasan_release_vmalloc.         purge_vmap_node() iteratively releases kasan vmalloc         allocations and flushes TLB for each vmap_area.           - [Rough calculation] Each flush_tlb_kernel_range() runs             about 7.5ms.               -- 2804 * 7.5ms = 21.03 seconds.               -- That's why a soft lock is triggered.  2. Extending the soft lockup time can work around the issue (For example,     # echo---truncated---\n\n    Update Instructions:\n\n    Run `sudo pro fix CVE-2024-56559` to fix the vulnerability. The problem can be corrected\n    by updating your system to the following package versions:\n\nlinux-image-4.13.0-16-generic - 4.13.0-16.19\nlinux-image-4.13.0-16-generic-lpae - 4.13.0-16.19\nlinux-image-4.13.0-16-lowlatency - 4.13.0-16.19\nlinux-image-extra-4.13.0-16-generic - 4.13.0-16.19\nNo subscription required\n\nlinux-image-5.4.0-37-generic - 5.4.0-37.41~18.04.1\nlinux-image-5.4.0-37-generic-lpae - 5.4.0-37.41~18.04.1\nlinux-image-5.4.0-37-lowlatency - 5.4.0-37.41~18.04.1\nlinux-image-unsigned-5.4.0-37-generic - 5.4.0-37.41~18.04.1\nlinux-image-unsigned-5.4.0-37-lowlatency - 5.4.0-37.41~18.04.1\nNo subscription required\n\nlinux-image-4.15.0-1002-kvm - 4.15.0-1002.2\nNo subscription required\n\nlinux-image-4.15.0-1001-aws - 4.15.0-1001.1\nNo subscription required\n\nlinux-image-5.4.0-1018-aws - 5.4.0-1018.18~18.04.1\nNo subscription required\n\nlinux-image-unsigned-4.15.0-1082-azure - 4.15.0-1082.92\nNo subscription required\n\nlinux-image-unsigned-5.4.0-1020-azure - 5.4.0-1020.20~18.04.1\nNo subscription required\n\nlinux-image-unsigned-4.15.0-1071-gcp - 4.15.0-1071.81\nNo subscription required\n\nlinux-image-unsigned-5.4.0-1019-gcp - 5.4.0-1019.19~18.04.2\nNo subscription required\n\nlinux-image-unsigned-5.4.0-1010-ibm - 5.4.0-1010.11~18.04.2\nNo subscription required\n\nlinux-image-unsigned-4.15.0-1007-oracle - 4.15.0-1007.9\nNo subscription required\n\nlinux-image-unsigned-5.4.0-1019-oracle - 5.4.0-1019.19~18.04.1\nNo subscription required\n\nlinux-image-5.4.0-1013-raspi - 5.4.0-1013.13~18.04.1\nNo subscription required",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 18.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-56559",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2024-56559"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-12-27 15:15:00 UTC",
			"cve": {
				"text": "CVE-2024-56559",
				"href": "https://ubuntu.com/security/CVE-2024-56559",
				"public": "20241227"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:200747740000000",
						"comment": "linux package in bionic, is related to the CVE in some way and has been fixed (note: '4.13.0-16.19')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000040",
						"comment": "linux-hwe: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201325960000060",
						"comment": "linux-hwe-5.4 package in bionic, is related to the CVE in some way and has been fixed (note: '5.4.0-37.41~18.04.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:200747740000040",
						"comment": "linux-kvm package in bionic, is related to the CVE in some way and has been fixed (note: '4.15.0-1002.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:200747740000050",
						"comment": "linux-aws package in bionic, is related to the CVE in some way and has been fixed (note: '4.15.0-1001.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000150",
						"comment": "linux-aws-5.0: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000200",
						"comment": "linux-aws-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201325960000110",
						"comment": "linux-aws-5.4 package in bionic, is related to the CVE in some way and has been fixed (note: '5.4.0-1018.18~18.04.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000070",
						"comment": "linux-azure: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201325960000010",
						"comment": "linux-azure-4.15 package in bionic, is related to the CVE in some way and has been fixed (note: '4.15.0-1082.92')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201585530000000",
						"comment": "linux-azure-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201325960000080",
						"comment": "linux-azure-5.4 package in bionic, is related to the CVE in some way and has been fixed (note: '5.4.0-1020.20~18.04.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000080",
						"comment": "linux-gcp: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201325960000050",
						"comment": "linux-gcp-4.15 package in bionic, is related to the CVE in some way and has been fixed (note: '4.15.0-1071.81')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000130",
						"comment": "linux-gcp-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201325960000100",
						"comment": "linux-gcp-5.4 package in bionic, is related to the CVE in some way and has been fixed (note: '5.4.0-1019.19~18.04.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000050",
						"comment": "linux-gke-4.15: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gke-5.0')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000280",
						"comment": "linux-gke-5.4: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000290",
						"comment": "linux-gkeop-5.4: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201431800000000",
						"comment": "linux-ibm-5.4 package in bionic, is related to the CVE in some way and has been fixed (note: '5.4.0-1010.11~18.04.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:200747740000130",
						"comment": "linux-oracle package in bionic, is related to the CVE in some way and has been fixed (note: '4.15.0-1007.9')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000140",
						"comment": "linux-oracle-5.0: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000180",
						"comment": "linux-oracle-5.3: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201325960000090",
						"comment": "linux-oracle-5.4 package in bionic, is related to the CVE in some way and has been fixed (note: '5.4.0-1019.19~18.04.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000100",
						"comment": "linux-oem: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201245420000010",
						"comment": "linux-raspi2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of standard support')."
					},
					{
						"test_ref": "oval:com.ubuntu.bionic:tst:201325960000070",
						"comment": "linux-raspi-5.4 package in bionic, is related to the CVE in some way and has been fixed (note: '5.4.0-1013.13~18.04.1')."
					}
				]
			}
		]
	}
}

{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.focal:def:2021470990000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2021-47099 on Ubuntu 20.04 LTS (focal) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved: veth:ensure skb entering GRO are not cloned. After commit d3256efd8e8b (\"veth:allow enabling NAPI even without XDP\"), if GRO is enabled on a veth deviceand TSO is disabled on the peer device, TCP skbs will go through the NAPIcallback. If there is no XDP program attached, the veth code does notperform any share check, and shared/cloned skbs could enter the GRO engine.Ignat reported a BUG triggered later-on due to the above condition: [53.970529][ C1] kernel BUG at net/core/skbuff.c:3574! [ 53.981755][ C1]invalid opcode: 0000 [#1] PREEMPT SMP KASAN PTI [ 53.982634][ C1] CPU: 1PID: 19 Comm: ksoftirqd/1 Not tainted 5.16.0-rc5+ #25 [ 53.982634][ C1]Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 0.0.0 02/06/2015 [53.982634][ C1] RIP: 0010:skb_shift+0x13ef/0x23b0 [ 53.982634][ C1] Code:ea 03 0f b6 04 02 48 89 fa 83 e2 07 38 d0 7f 08 84 c0 0f 85 41 0c 00 00 4180 7f 02 00 4d 8d b5 d0 00 00 00 0f 85 74 f5 ff ff <0f> 0b 4d 8d 77 20 be04 00 00 00 4c 89 44 24 78 4c 89 f7 4c 89 8c [ 53.982634][ C1] RSP:0018:ffff8881008f7008 EFLAGS: 00010246 [ 53.982634][ C1] RAX:0000000000000000 RBX: ffff8881180b4c80 RCX: 0000000000000000 [ 53.982634][C1] RDX: 0000000000000002 RSI: ffff8881180b4d3c RDI: ffff88810bc9cac2 [53.982634][ C1] RBP: ffff8881008f70b8 R08: ffff8881180b4cf4 R09:ffff8881180b4cf0 [ 53.982634][ C1] R10: ffffed1022999e5c R11:0000000000000002 R12: 0000000000000590 [ 53.982634][ C1] R13:ffff88810f940c80 R14: ffff88810f940d50 R15: ffff88810bc9cac0 [ 53.982634][C1] FS: 0000000000000000(0000) GS:ffff888235880000(0000)knlGS:0000000000000000 [ 53.982634][ C1] CS: 0010 DS: 0000 ES: 0000 CR0:0000000080050033 [ 53.982634][ C1] CR2: 00007ff5f9b86680 CR3:0000000108ce8004 CR4: 0000000000170ee0 [ 53.982634][ C1] Call Trace: [53.982634][ C1] <TASK> [ 53.982634][ C1] tcp_sacktag_walk+0xaba/0x18e0 [53.982634][ C1] tcp_sacktag_write_queue+0xe7b/0x3460 [ 53.982634][ C1]tcp_ack+0x2666/0x54b0 [ 53.982634][ C1] tcp_rcv_established+0x4d9/0x20f0 [53.982634][ C1] tcp_v4_do_rcv+0x551/0x810 [ 53.982634][ C1]tcp_v4_rcv+0x22ed/0x2ed0 [ 53.982634][ C1]ip_protocol_deliver_rcu+0x96/0xaf0 [ 53.982634][ C1]ip_local_deliver_finish+0x1e0/0x2f0 [ 53.982634][ C1]ip_sublist_rcv_finish+0x211/0x440 [ 53.982634][ C1]ip_list_rcv_finish.constprop.0+0x424/0x660 [ 53.982634][ C1]ip_list_rcv+0x2c8/0x410 [ 53.982634][ C1]__netif_receive_skb_list_core+0x65c/0x910 [ 53.982634][ C1]netif_receive_skb_list_internal+0x5f9/0xcb0 [ 53.982634][ C1]napi_complete_done+0x188/0x6e0 [ 53.982634][ C1] gro_cell_poll+0x10c/0x1d0[ 53.982634][ C1] __napi_poll+0xa1/0x530 [ 53.982634][ C1]net_rx_action+0x567/0x1270 [ 53.982634][ C1] __do_softirq+0x28a/0x9ba [53.982634][ C1] run_ksoftirqd+0x32/0x60 [ 53.982634][ C1]smpboot_thread_fn+0x559/0x8c0 [ 53.982634][ C1] kthread+0x3b9/0x490 [53.982634][ C1] ret_from_fork+0x22/0x30 [ 53.982634][ C1] </TASK> Addressthe issue by skipping the GRO stage for shared or cloned skbs. To reducethe chance of OoO, try to unclone the skbs before giving up. v1 -> v2: -use avoid skb_copy and fallback to netif_receive_skb - Eric",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 20.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2021-47099",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2021-47099"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-03-04 18:15:00 UTC",
			"cve": {
				"text": "CVE-2021-47099",
				"href": "https://ubuntu.com/security/CVE-2021-47099",
				"public": "20240304"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000000",
						"comment": "linux package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000100",
						"comment": "linux-hwe-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000180",
						"comment": "linux-hwe-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000260",
						"comment": "linux-hwe-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000340",
						"comment": "linux-hwe-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000060",
						"comment": "linux-kvm package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000020",
						"comment": "linux-aws package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000130",
						"comment": "linux-aws-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000190",
						"comment": "linux-aws-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000270",
						"comment": "linux-aws-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000350",
						"comment": "linux-aws-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000040",
						"comment": "linux-azure package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000140",
						"comment": "linux-azure-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000200",
						"comment": "linux-azure-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000310",
						"comment": "linux-azure-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000380",
						"comment": "linux-azure-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000300",
						"comment": "linux-azure-fde: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-fde-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000400",
						"comment": "linux-azure-fde-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000170",
						"comment": "linux-bluefield package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000050",
						"comment": "linux-gcp package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000150",
						"comment": "linux-gcp-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000230",
						"comment": "linux-gcp-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000290",
						"comment": "linux-gcp-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000360",
						"comment": "linux-gcp-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000030",
						"comment": "linux-gke: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000370",
						"comment": "linux-gke-5.15: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000120",
						"comment": "linux-gkeop package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000430",
						"comment": "linux-gkeop-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000220",
						"comment": "linux-ibm package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000440",
						"comment": "linux-ibm-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000250",
						"comment": "linux-intel-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000320",
						"comment": "linux-intel-iotg-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000410",
						"comment": "linux-iot package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000330",
						"comment": "linux-lowlatency-hwe-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000070",
						"comment": "linux-oracle package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000160",
						"comment": "linux-oracle-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000210",
						"comment": "linux-oracle-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000280",
						"comment": "linux-oracle-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000390",
						"comment": "linux-oracle-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000080",
						"comment": "linux-oem-5.6: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.10')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000110",
						"comment": "linux-oem-5.10: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201585530000000",
						"comment": "linux-oem-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.14')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000240",
						"comment": "linux-oem-5.14: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000090",
						"comment": "linux-raspi package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000010",
						"comment": "linux-raspi2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-raspi')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000420",
						"comment": "linux-xilinx-zynqmp package in focal is affected and may need fixing."
					}
				]
			}
		]
	}
}

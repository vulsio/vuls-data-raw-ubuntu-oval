{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.focal:def:2024270040000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-27004 on Ubuntu 20.04 FIPS Compliant (focal) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved: clk:Get runtime PM before walking tree during disable_unused Doug reported [1]the following hung task: INFO: task swapper/0:1 blocked for more than 122seconds. Not tainted 5.15.149-21875-gf795ebc40eb8 #1 \"echo 0 >/proc/sys/kernel/hung_task_timeout_secs\" disables this message.task:swapper/0 state:D stack: 0 pid: 1 ppid: 0 flags:0x00000008 Call trace:__switch_to+0xf4/0x1f4 __schedule+0x418/0xb80 schedule+0x5c/0x10crpm_resume+0xe0/0x52c rpm_resume+0x178/0x52c __pm_runtime_resume+0x58/0x98clk_pm_runtime_get+0x30/0xb0 clk_disable_unused_subtree+0x58/0x208clk_disable_unused_subtree+0x38/0x208 clk_disable_unused_subtree+0x38/0x208clk_disable_unused_subtree+0x38/0x208 clk_disable_unused_subtree+0x38/0x208clk_disable_unused+0x4c/0xe4 do_one_initcall+0xcc/0x2d8do_initcall_level+0xa4/0x148 do_initcalls+0x5c/0x9cdo_basic_setup+0x24/0x30 kernel_init_freeable+0xec/0x164kernel_init+0x28/0x120 ret_from_fork+0x10/0x20 INFO: task kworker/u16:0:9blocked for more than 122 seconds. Not tainted 5.15.149-21875-gf795ebc40eb8#1 \"echo 0 > /proc/sys/kernel/hung_task_timeout_secs\" disables thismessage. task:kworker/u16:0 state:D stack: 0 pid: 9 ppid: 2flags:0x00000008 Workqueue: events_unbound deferred_probe_work_func Calltrace: __switch_to+0xf4/0x1f4 __schedule+0x418/0xb80 schedule+0x5c/0x10cschedule_preempt_disabled+0x2c/0x48 __mutex_lock+0x238/0x488__mutex_lock_slowpath+0x1c/0x28 mutex_lock+0x50/0x74clk_prepare_lock+0x7c/0x9c clk_core_prepare_lock+0x20/0x44clk_prepare+0x24/0x30 clk_bulk_prepare+0x40/0xb0mdss_runtime_resume+0x54/0x1c8 pm_generic_runtime_resume+0x30/0x44__genpd_runtime_resume+0x68/0x7c genpd_runtime_resume+0x108/0x1f4__rpm_callback+0x84/0x144 rpm_callback+0x30/0x88 rpm_resume+0x1f4/0x52crpm_resume+0x178/0x52c __pm_runtime_resume+0x58/0x98__device_attach+0xe0/0x170 device_initial_probe+0x1c/0x28bus_probe_device+0x3c/0x9c device_add+0x644/0x814mipi_dsi_device_register_full+0xe4/0x170devm_mipi_dsi_device_register_full+0x28/0x70 ti_sn_bridge_probe+0x1dc/0x2c0auxiliary_bus_probe+0x4c/0x94 really_probe+0xcc/0x2c8__driver_probe_device+0xa8/0x130 driver_probe_device+0x48/0x110__device_attach_driver+0xa4/0xcc bus_for_each_drv+0x8c/0xd8__device_attach+0xf8/0x170 device_initial_probe+0x1c/0x28bus_probe_device+0x3c/0x9c deferred_probe_work_func+0x9c/0xd8process_one_work+0x148/0x518 worker_thread+0x138/0x350 kthread+0x138/0x1e0ret_from_fork+0x10/0x20 The first thread is walking the clk tree andcalling clk_pm_runtime_get() to power on devices required to read the clkhardware via struct clk_ops::is_enabled(). This thread holds the clkprepare_lock, and is trying to runtime PM resume a device, when it findsthat the device is in the process of resuming so the thread schedule()saway waiting for the device to finish resuming before continuing. Thesecond thread is runtime PM resuming the same device, but the runtimeresume callback is calling clk_prepare(), trying to grab the prepare_lockwaiting on the first thread. This is a classic ABBA deadlock. To properlyfix the deadlock, we must never runtime PM resume or suspend a device withthe clk prepare_lock held. Actually doing that is near impossible todaybecause the global prepare_lock would have to be dropped in the middle ofthe tree, the device runtime PM resumed/suspended, and then theprepare_lock grabbed again to ensure consistency of the clk tree topology.If anything changes with the clk tree in the meantime, we've lost and willneed to start the operation all over again. Luckily, most of the time we'resimply incrementing or decrementing the runtime PM count on an activedevice, so we don't have the chance to schedule away with the prepare_lockheld. Let's fix this immediate problem that can be ---truncated---",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 20.04 FIPS Compliant"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-27004",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2024-27004"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-05-01 06:15:00 UTC",
			"cve": {
				"text": "CVE-2024-27004",
				"href": "https://ubuntu.com/security/CVE-2024-27004",
				"public": "20240501"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000000",
						"comment": "linux package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000100",
						"comment": "linux-hwe-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000180",
						"comment": "linux-hwe-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000260",
						"comment": "linux-hwe-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000340",
						"comment": "linux-hwe-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000060",
						"comment": "linux-kvm package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000020",
						"comment": "linux-aws package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000130",
						"comment": "linux-aws-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000190",
						"comment": "linux-aws-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000270",
						"comment": "linux-aws-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000350",
						"comment": "linux-aws-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000040",
						"comment": "linux-azure package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000140",
						"comment": "linux-azure-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000200",
						"comment": "linux-azure-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000310",
						"comment": "linux-azure-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000380",
						"comment": "linux-azure-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000300",
						"comment": "linux-azure-fde: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-fde-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000400",
						"comment": "linux-azure-fde-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000170",
						"comment": "linux-bluefield package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201585530000010",
						"comment": "linux-fips package in fips-updates/focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000050",
						"comment": "linux-gcp package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000150",
						"comment": "linux-gcp-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000230",
						"comment": "linux-gcp-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000290",
						"comment": "linux-gcp-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000360",
						"comment": "linux-gcp-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000030",
						"comment": "linux-gke: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000370",
						"comment": "linux-gke-5.15: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000120",
						"comment": "linux-gkeop package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000430",
						"comment": "linux-gkeop-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000220",
						"comment": "linux-ibm package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000440",
						"comment": "linux-ibm-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000250",
						"comment": "linux-intel-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000320",
						"comment": "linux-intel-iotg-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000410",
						"comment": "linux-iot package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000330",
						"comment": "linux-lowlatency-hwe-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000070",
						"comment": "linux-oracle package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000160",
						"comment": "linux-oracle-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000210",
						"comment": "linux-oracle-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000280",
						"comment": "linux-oracle-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000390",
						"comment": "linux-oracle-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000080",
						"comment": "linux-oem-5.6: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.10')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000110",
						"comment": "linux-oem-5.10: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201585530000000",
						"comment": "linux-oem-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.14')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000240",
						"comment": "linux-oem-5.14: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000090",
						"comment": "linux-raspi package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000010",
						"comment": "linux-raspi2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-raspi')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000420",
						"comment": "linux-xilinx-zynqmp package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000450",
						"comment": "linux-aws-fips package in fips-updates/focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000460",
						"comment": "linux-azure-fips package in fips-updates/focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000470",
						"comment": "linux-gcp-fips package in fips-updates/focal is affected and may need fixing."
					}
				]
			}
		]
	}
}

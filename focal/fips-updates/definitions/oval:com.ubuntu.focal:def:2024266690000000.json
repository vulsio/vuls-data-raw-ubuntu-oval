{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.focal:def:2024266690000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-26669 on Ubuntu 20.04 FIPS Compliant (focal) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:net/sched: flower: Fix chain template offloadWhen a qdisc is deleted from a net device the stack instructs theunderlying driver to remove its flow offload callback from theassociated filter block using the 'FLOW_BLOCK_UNBIND' command. The stackthen continues to replay the removal of the filters in the block forthis driver by iterating over the chains in the block and invoking the'reoffload' operation of the classifier being used. In turn, theclassifier in its 'reoffload' operation prepares and emits a'FLOW_CLS_DESTROY' command for each filter.However, the stack does not do the same for chain templates and theunderlying driver never receives a 'FLOW_CLS_TMPLT_DESTROY' command whena qdisc is deleted. This results in a memory leak [1] which can bereproduced using [2].Fix by introducing a 'tmplt_reoffload' operation and have the stackinvoke it with the appropriate arguments as part of the replay.Implement the operation in the sole classifier that supports chaintemplates (flower) by emitting the 'FLOW_CLS_TMPLT_{CREATE,DESTROY}'command based on whether a flow offload callback is being bound to afilter block or being unbound from one.As far as I can tell, the issue happens since cited commit whichreordered tcf_block_offload_unbind() before tcf_block_flush_all_chains()in __tcf_block_put(). The order cannot be reversed as the filter blockis expected to be freed after flushing all the chains.[1]unreferenced object 0xffff888107e28800 (size 2048):  comm \"tc\", pid 1079, jiffies 4294958525 (age 3074.287s)  hex dump (first 32 bytes):    b1 a6 7c 11 81 88 ff ff e0 5b b3 10 81 88 ff ff  ..|......[......    01 00 00 00 00 00 00 00 e0 aa b0 84 ff ff ff ff  ................  backtrace:    [<ffffffff81c06a68>] __kmem_cache_alloc_node+0x1e8/0x320    [<ffffffff81ab374e>] __kmalloc+0x4e/0x90    [<ffffffff832aec6d>] mlxsw_sp_acl_ruleset_get+0x34d/0x7a0    [<ffffffff832bc195>] mlxsw_sp_flower_tmplt_create+0x145/0x180    [<ffffffff832b2e1a>] mlxsw_sp_flow_block_cb+0x1ea/0x280    [<ffffffff83a10613>] tc_setup_cb_call+0x183/0x340    [<ffffffff83a9f85a>] fl_tmplt_create+0x3da/0x4c0    [<ffffffff83a22435>] tc_ctl_chain+0xa15/0x1170    [<ffffffff838a863c>] rtnetlink_rcv_msg+0x3cc/0xed0    [<ffffffff83ac87f0>] netlink_rcv_skb+0x170/0x440    [<ffffffff83ac6270>] netlink_unicast+0x540/0x820    [<ffffffff83ac6e28>] netlink_sendmsg+0x8d8/0xda0    [<ffffffff83793def>] ____sys_sendmsg+0x30f/0xa80    [<ffffffff8379d29a>] ___sys_sendmsg+0x13a/0x1e0    [<ffffffff8379d50c>] __sys_sendmsg+0x11c/0x1f0    [<ffffffff843b9ce0>] do_syscall_64+0x40/0xe0unreferenced object 0xffff88816d2c0400 (size 1024):  comm \"tc\", pid 1079, jiffies 4294958525 (age 3074.287s)  hex dump (first 32 bytes):    40 00 00 00 00 00 00 00 57 f6 38 be 00 00 00 00  @.......W.8.....    10 04 2c 6d 81 88 ff ff 10 04 2c 6d 81 88 ff ff  ..,m......,m....  backtrace:    [<ffffffff81c06a68>] __kmem_cache_alloc_node+0x1e8/0x320    [<ffffffff81ab36c1>] __kmalloc_node+0x51/0x90    [<ffffffff81a8ed96>] kvmalloc_node+0xa6/0x1f0    [<ffffffff82827d03>] bucket_table_alloc.isra.0+0x83/0x460    [<ffffffff82828d2b>] rhashtable_init+0x43b/0x7c0    [<ffffffff832aed48>] mlxsw_sp_acl_ruleset_get+0x428/0x7a0    [<ffffffff832bc195>] mlxsw_sp_flower_tmplt_create+0x145/0x180    [<ffffffff832b2e1a>] mlxsw_sp_flow_block_cb+0x1ea/0x280    [<ffffffff83a10613>] tc_setup_cb_call+0x183/0x340    [<ffffffff83a9f85a>] fl_tmplt_create+0x3da/0x4c0    [<ffffffff83a22435>] tc_ctl_chain+0xa15/0x1170    [<ffffffff838a863c>] rtnetlink_rcv_msg+0x3cc/0xed0    [<ffffffff83ac87f0>] netlink_rcv_skb+0x170/0x440    [<ffffffff83ac6270>] netlink_unicast+0x540/0x820    [<ffffffff83ac6e28>] netlink_sendmsg+0x8d8/0xda0    [<ffffffff83793def>] ____sys_sendmsg+0x30f/0xa80[2] # tc qdisc add dev swp1 clsact # tc chain add dev swp1 ingress proto ip chain 1 flower dst_ip 0.0.0.0/32 # tc qdisc del dev---truncated---",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 20.04 FIPS Compliant"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-26669",
			"ref_url": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-26669"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-04-02 07:15:00 UTC",
			"cve": {
				"text": "CVE-2024-26669",
				"href": "https://ubuntu.com/security/CVE-2024-26669",
				"public": "20240402"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000000",
						"comment": "linux package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000100",
						"comment": "linux-hwe-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000180",
						"comment": "linux-hwe-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000260",
						"comment": "linux-hwe-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000340",
						"comment": "linux-hwe-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000060",
						"comment": "linux-kvm package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000020",
						"comment": "linux-aws package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000130",
						"comment": "linux-aws-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000190",
						"comment": "linux-aws-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000270",
						"comment": "linux-aws-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000350",
						"comment": "linux-aws-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000040",
						"comment": "linux-azure package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000140",
						"comment": "linux-azure-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000200",
						"comment": "linux-azure-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000310",
						"comment": "linux-azure-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000380",
						"comment": "linux-azure-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000300",
						"comment": "linux-azure-fde: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-fde-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000400",
						"comment": "linux-azure-fde-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000170",
						"comment": "linux-bluefield package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201585530000010",
						"comment": "linux-fips package in fips-updates/focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000050",
						"comment": "linux-gcp package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000150",
						"comment": "linux-gcp-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000230",
						"comment": "linux-gcp-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000290",
						"comment": "linux-gcp-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000360",
						"comment": "linux-gcp-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000030",
						"comment": "linux-gke: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000370",
						"comment": "linux-gke-5.15: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000120",
						"comment": "linux-gkeop package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000430",
						"comment": "linux-gkeop-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000220",
						"comment": "linux-ibm package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000440",
						"comment": "linux-ibm-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000250",
						"comment": "linux-intel-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000320",
						"comment": "linux-intel-iotg-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000410",
						"comment": "linux-iot package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000330",
						"comment": "linux-lowlatency-hwe-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000070",
						"comment": "linux-oracle package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000160",
						"comment": "linux-oracle-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000210",
						"comment": "linux-oracle-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000280",
						"comment": "linux-oracle-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000390",
						"comment": "linux-oracle-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000080",
						"comment": "linux-oem-5.6: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.10')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000110",
						"comment": "linux-oem-5.10: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201585530000000",
						"comment": "linux-oem-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.14')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000240",
						"comment": "linux-oem-5.14: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000090",
						"comment": "linux-raspi package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000010",
						"comment": "linux-raspi2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-raspi')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000420",
						"comment": "linux-xilinx-zynqmp package in focal is affected and may need fixing."
					}
				]
			}
		]
	}
}

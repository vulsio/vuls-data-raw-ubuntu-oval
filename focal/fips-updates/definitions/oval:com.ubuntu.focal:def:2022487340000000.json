{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.focal:def:2022487340000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2022-48734 on Ubuntu 20.04 FIPS Compliant (focal) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:btrfs: fix deadlock between quota disable and qgroup rescan workerQuota disable ioctl starts a transaction before waiting for the qgrouprescan worker completes. However, this wait can be infinite and resultsin deadlock because of circular dependency among the quota disableioctl, the qgroup rescan worker and the other task with transaction suchas block group relocation task.The deadlock happens with the steps following:1) Task A calls ioctl to disable quota. It starts a transaction and   waits for qgroup rescan worker completes.2) Task B such as block group relocation task starts a transaction and   joins to the transaction that task A started. Then task B commits to   the transaction. In this commit, task B waits for a commit by task A.3) Task C as the qgroup rescan worker starts its job and starts a   transaction. In this transaction start, task C waits for completion   of the transaction that task A started and task B committed.This deadlock was found with fstests test case btrfs/115 and a zonednull_blk device. The test case enables and disables quota, and theblock group reclaim was triggered during the quota disable by chance.The deadlock was also observed by running quota enable and disable inparallel with 'btrfs balance' command on regular null_blk devices.An example report of the deadlock:  [372.469894] INFO: task kworker/u16:6:103 blocked for more than 122seconds.  [372.479944]       Not tainted 5.16.0-rc8 #7  [372.485067] \"echo 0 > /proc/sys/kernel/hung_task_timeout_secs\" disablesthis message.  [372.493898] task:kworker/u16:6   state:D stack:    0 pid:  103 ppid:2 flags:0x00004000  [372.503285] Workqueue: btrfs-qgroup-rescan btrfs_work_helper [btrfs]  [372.510782] Call Trace:  [372.514092]  <TASK>  [372.521684]  __schedule+0xb56/0x4850  [372.530104]  ? io_schedule_timeout+0x190/0x190  [372.538842]  ? lockdep_hardirqs_on+0x7e/0x100  [372.547092]  ? _raw_spin_unlock_irqrestore+0x3e/0x60  [372.555591]  schedule+0xe0/0x270  [372.561894]  btrfs_commit_transaction+0x18bb/0x2610 [btrfs]  [372.570506]  ? btrfs_apply_pending_changes+0x50/0x50 [btrfs]  [372.578875]  ? free_unref_page+0x3f2/0x650  [372.585484]  ? finish_wait+0x270/0x270  [372.591594]  ? release_extent_buffer+0x224/0x420 [btrfs]  [372.599264]  btrfs_qgroup_rescan_worker+0xc13/0x10c0 [btrfs]  [372.607157]  ? lock_release+0x3a9/0x6d0  [372.613054]  ? btrfs_qgroup_account_extent+0xda0/0xda0 [btrfs]  [372.620960]  ? do_raw_spin_lock+0x11e/0x250  [372.627137]  ? rwlock_bug.part.0+0x90/0x90  [372.633215]  ? lock_is_held_type+0xe4/0x140  [372.639404]  btrfs_work_helper+0x1ae/0xa90 [btrfs]  [372.646268]  process_one_work+0x7e9/0x1320  [372.652321]  ? lock_release+0x6d0/0x6d0  [372.658081]  ? pwq_dec_nr_in_flight+0x230/0x230  [372.664513]  ? rwlock_bug.part.0+0x90/0x90  [372.670529]  worker_thread+0x59e/0xf90  [372.676172]  ? process_one_work+0x1320/0x1320  [372.682440]  kthread+0x3b9/0x490  [372.687550]  ? _raw_spin_unlock_irq+0x24/0x50  [372.693811]  ? set_kthread_struct+0x100/0x100  [372.700052]  ret_from_fork+0x22/0x30  [372.705517]  </TASK>  [372.709747] INFO: task btrfs-transacti:2347 blocked for more than 123seconds.  [372.729827]       Not tainted 5.16.0-rc8 #7  [372.745907] \"echo 0 > /proc/sys/kernel/hung_task_timeout_secs\" disablesthis message.  [372.767106] task:btrfs-transacti state:D stack:    0 pid: 2347 ppid:2 flags:0x00004000  [372.787776] Call Trace:  [372.801652]  <TASK>  [372.812961]  __schedule+0xb56/0x4850  [372.830011]  ? io_schedule_timeout+0x190/0x190  [372.852547]  ? lockdep_hardirqs_on+0x7e/0x100  [372.871761]  ? _raw_spin_unlock_irqrestore+0x3e/0x60  [372.886792]  schedule+0xe0/0x270  [372.901685]  wait_current_trans+0x22c/0x310 [btrfs]  [372.919743]  ? btrfs_put_transaction+0x3d0/0x3d0 [btrfs]  [372.938923]  ? finish_wait+0x270/0x270  [372.959085]  ? join_transaction+0xc7---truncated---",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 20.04 FIPS Compliant"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2022-48734",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2022-48734"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-06-20",
			"cve": {
				"text": "CVE-2022-48734",
				"href": "https://ubuntu.com/security/CVE-2022-48734",
				"public": "20240620"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000000",
						"comment": "linux package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000100",
						"comment": "linux-hwe-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000180",
						"comment": "linux-hwe-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000260",
						"comment": "linux-hwe-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000340",
						"comment": "linux-hwe-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000060",
						"comment": "linux-kvm package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000020",
						"comment": "linux-aws package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000130",
						"comment": "linux-aws-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000190",
						"comment": "linux-aws-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000270",
						"comment": "linux-aws-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000350",
						"comment": "linux-aws-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000040",
						"comment": "linux-azure package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000140",
						"comment": "linux-azure-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000200",
						"comment": "linux-azure-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000310",
						"comment": "linux-azure-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000380",
						"comment": "linux-azure-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000300",
						"comment": "linux-azure-fde: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-fde-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000400",
						"comment": "linux-azure-fde-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000170",
						"comment": "linux-bluefield package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201585530000010",
						"comment": "linux-fips package in fips-updates/focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000450",
						"comment": "linux-aws-fips package in fips-updates/focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000460",
						"comment": "linux-azure-fips package in fips-updates/focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000470",
						"comment": "linux-gcp-fips package in fips-updates/focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000050",
						"comment": "linux-gcp package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000150",
						"comment": "linux-gcp-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000230",
						"comment": "linux-gcp-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000290",
						"comment": "linux-gcp-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000360",
						"comment": "linux-gcp-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000030",
						"comment": "linux-gke: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000370",
						"comment": "linux-gke-5.15: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000120",
						"comment": "linux-gkeop package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000430",
						"comment": "linux-gkeop-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000220",
						"comment": "linux-ibm package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000440",
						"comment": "linux-ibm-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000250",
						"comment": "linux-intel-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000320",
						"comment": "linux-intel-iotg-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000410",
						"comment": "linux-iot package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000330",
						"comment": "linux-lowlatency-hwe-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000070",
						"comment": "linux-oracle package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000160",
						"comment": "linux-oracle-5.8: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000210",
						"comment": "linux-oracle-5.11: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000280",
						"comment": "linux-oracle-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000390",
						"comment": "linux-oracle-5.15 package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000080",
						"comment": "linux-oem-5.6: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.10')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000110",
						"comment": "linux-oem-5.10: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.13')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201585530000000",
						"comment": "linux-oem-5.13: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-5.14')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000240",
						"comment": "linux-oem-5.14: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-hwe-5.15')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000090",
						"comment": "linux-raspi package in focal is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000010",
						"comment": "linux-raspi2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-raspi')."
					},
					{
						"test_ref": "oval:com.ubuntu.focal:tst:201245420000420",
						"comment": "linux-xilinx-zynqmp package in focal is affected and may need fixing."
					}
				]
			}
		]
	}
}

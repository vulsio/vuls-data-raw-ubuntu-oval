{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.noble:def:2024359800000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-35980 on Ubuntu 24.04 LTS (noble) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:arm64: tlb: Fix TLBI RANGE operandKVM/arm64 relies on TLBI RANGE feature to flush TLBs when the dirtypages are collected by VMM and the page table entries become writeprotected during live migration. Unfortunately, the operand passedto the TLBI RANGE instruction isn't correctly sorted out due to thecommit 117940aa6e5f (\"KVM: arm64: Define kvm_tlb_flush_vmid_range()\").It leads to crash on the destination VM after live migration becauseTLBs aren't flushed completely and some of the dirty pages are missed.For example, I have a VM where 8GB memory is assigned, starting from0x40000000 (1GB). Note that the host has 4KB as the base page size.In the middile of migration, kvm_tlb_flush_vmid_range() is executedto flush TLBs. It passes MAX_TLBI_RANGE_PAGES as the argument to__kvm_tlb_flush_vmid_range() and __flush_s2_tlb_range_op(). SCALE#3and NUM#31, corresponding to MAX_TLBI_RANGE_PAGES, isn't supportedby __TLBI_RANGE_NUM(). In this specific case, -1 has been returnedfrom __TLBI_RANGE_NUM() for SCALE#3/2/1/0 and rejected by the loopin the __flush_tlb_range_op() until the variable @scale underflowsand becomes -9, 0xffff708000040000 is set as the operand. The operandis wrong since it's sorted out by __TLBI_VADDR_RANGE() according toinvalid @scale and @num.Fix it by extending __TLBI_RANGE_NUM() to support the combination ofSCALE#3 and NUM#31. With the changes, [-1 31] instead of [-1 30] canbe returned from the macro, meaning the TLBs for 0x200000 pages in theabove example can be flushed in one shoot with SCALE#3 and NUM#31. Themacro TLBI_RANGE_MASK is dropped since no one uses it any more. Thecomments are also adjusted accordingly.",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 24.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-35980",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2024-35980"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-05-20 10:15:00 UTC",
			"cve": {
				"text": "CVE-2024-35980",
				"href": "https://ubuntu.com/security/CVE-2024-35980",
				"public": "20240520"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000000",
						"comment": "linux package in noble is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000010",
						"comment": "linux-aws package in noble is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000030",
						"comment": "linux-azure package in noble is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000040",
						"comment": "linux-gcp package in noble is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000020",
						"comment": "linux-gke package in noble is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000070",
						"comment": "linux-ibm package in noble is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000080",
						"comment": "linux-lowlatency package in noble is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000050",
						"comment": "linux-oracle package in noble is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000060",
						"comment": "linux-raspi package in noble is affected and may need fixing."
					}
				]
			}
		]
	}
}

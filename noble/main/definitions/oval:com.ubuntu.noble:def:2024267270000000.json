{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.noble:def:2024267270000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-26727 on Ubuntu 24.04 LTS (noble) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved: btrfs:do not ASSERT() if the newly created subvolume already got read [BUG] Thereis a syzbot crash, triggered by the ASSERT() during subvolume creation:assertion failed: !anon_dev, in fs/btrfs/disk-io.c:1319 ------------[ cuthere ]------------ kernel BUG at fs/btrfs/disk-io.c:1319! invalid opcode:0000 [#1] PREEMPT SMP KASAN RIP: 0010:btrfs_get_root_ref.part.0+0x9aa/0xa60<TASK> btrfs_get_new_fs_root+0xd3/0xf0 create_subvol+0xd02/0x1650btrfs_mksubvol+0xe95/0x12b0 __btrfs_ioctl_snap_create+0x2f9/0x4f0btrfs_ioctl_snap_create+0x16b/0x200 btrfs_ioctl+0x35f0/0x5cf0__x64_sys_ioctl+0x19d/0x210 do_syscall_64+0x3f/0xe0entry_SYSCALL_64_after_hwframe+0x63/0x6b ---[ end trace 0000000000000000]--- [CAUSE] During create_subvol(), after inserting root item for thenewly created subvolume, we would trigger btrfs_get_new_fs_root() to getthe btrfs_root of that subvolume. The idea here is, we have preallocated ananonymous device number for the subvolume, thus we can assign it to the newsubvolume. But there is really nothing preventing things like backref walkto read the new subvolume. If that happens before we callbtrfs_get_new_fs_root(), the subvolume would be read out, with a newanonymous device number assigned already. In that case, we would triggerASSERT(), as we really expect no one to read out that subvolume (which isnot yet accessible from the fs). But things like backref walk is stillpossible to trigger the read on the subvolume. Thus our assumption on theASSERT() is not correct in the first place. [FIX] Fix it by removing theASSERT(), and just free the @anon_dev, reset it to 0, and continue. If thesubvolume tree is read out by something else, it should have already get anew anon_dev assigned thus we only need to free the preallocated one.\n\n    Update Instructions:\n\n    Run `sudo pro fix CVE-2024-26727` to fix the vulnerability. The problem can be corrected\n    by updating your system to the following package versions:\n\nlinux-image-6.8.0-11-generic - 6.8.0-11.11\nlinux-image-unsigned-6.8.0-11-generic - 6.8.0-11.11\nlinux-image-unsigned-6.8.0-11-generic-64k - 6.8.0-11.11\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1006-aws - 6.8.0-1006.6\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1001-azure - 6.8.0-1001.1\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1002-gcp - 6.8.0-1002.2\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1003-gke - 6.8.0-1003.5\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1003-ibm - 6.8.0-1003.3\nNo subscription required\n\nlinux-image-unsigned-6.8.0-25-lowlatency - 6.8.0-25.25.3\nlinux-image-unsigned-6.8.0-25-lowlatency-64k - 6.8.0-25.25.3\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1004-oracle - 6.8.0-1004.4\nlinux-image-unsigned-6.8.0-1004-oracle-64k - 6.8.0-1004.4\nNo subscription required\n\nlinux-image-6.8.0-1001-raspi - 6.8.0-1001.1\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1003-oem - 6.8.0-1003.3\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1005-intel - 6.8.0-1001.6\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1008-realtime - 6.8.0-1008.19\nAvailable with Ubuntu Pro: https://ubuntu.com/pro",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 24.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-26727",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2024-26727"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-04-03 15:15:00 UTC",
			"cve": {
				"text": "CVE-2024-26727",
				"href": "https://ubuntu.com/security/CVE-2024-26727",
				"public": "20240403"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2023240230000000",
						"comment": "linux package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-11.11')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2022380960000050",
						"comment": "linux-aws package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1006.6')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2021474320000020",
						"comment": "linux-azure package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1001.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2023240230000010",
						"comment": "linux-gcp package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1002.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2016107230000020",
						"comment": "linux-gke package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1003.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2016107230000080",
						"comment": "linux-ibm package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1003.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2023526310000000",
						"comment": "linux-lowlatency package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-25.25.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2023526310000010",
						"comment": "linux-oracle package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1004.4')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2021474320000020",
						"comment": "linux-raspi package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1001.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2016107230000080",
						"comment": "linux-oem-6.8 package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1003.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2016107230000090",
						"comment": "linux-intel package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1001.6')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201245420000110",
						"comment": "linux-raspi-realtime package in noble is affected. An update containing the fix has been completed and is pending publication (note: '6.8.0-2001.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:2016107230000110",
						"comment": "linux-realtime package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1008.19')."
					}
				]
			}
		]
	}
}

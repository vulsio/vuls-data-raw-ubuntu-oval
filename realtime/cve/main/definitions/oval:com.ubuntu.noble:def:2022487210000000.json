{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.noble:def:2022487210000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2022-48721 on Ubuntu 24.04 LTS (noble) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:net/smc: Forward wakeup to smc socket waitqueue after fallback When wereplace TCP with SMC and a fallback occurs, there may be some socketwaitqueue entries remaining in smc socket->wq, such as eppoll_entriesinserted by userspace applications. After the fallback, data flows overTCP/IP and only clcsocket->wq will be woken up. Applications can't benotified by the entries which were inserted in smc socket->wq beforefallback. So we need a mechanism to wake up smc socket->wq at the same timeif some entries remaining in it. The current workaround is to transfer theentries from smc socket->wq to clcsock->wq during the fallback. But thismay cause a crash like this: general protection fault, probably fornon-canonical address 0xdead000000000100: 0000 [#1] PREEMPT SMP PTI CPU: 3PID: 0 Comm: swapper/3 Kdump: loaded Tainted: G E 5.16.0+ #107 RIP:0010:__wake_up_common+0x65/0x170 Call Trace: <IRQ>__wake_up_common_lock+0x7a/0xc0 sock_def_readable+0x3c/0x70tcp_data_queue+0x4a7/0xc40 tcp_rcv_established+0x32f/0x660 ?sk_filter_trim_cap+0xcb/0x2e0 tcp_v4_do_rcv+0x10b/0x260tcp_v4_rcv+0xd2a/0xde0 ip_protocol_deliver_rcu+0x3b/0x1d0ip_local_deliver_finish+0x54/0x60 ip_local_deliver+0x6a/0x110 ?tcp_v4_early_demux+0xa2/0x140 ? tcp_v4_early_demux+0x10d/0x140ip_sublist_rcv_finish+0x49/0x60 ip_sublist_rcv+0x19d/0x230ip_list_rcv+0x13e/0x170 __netif_receive_skb_list_core+0x1c2/0x240netif_receive_skb_list_internal+0x1e6/0x320 napi_complete_done+0x11d/0x190mlx5e_napi_poll+0x163/0x6b0 [mlx5_core] __napi_poll+0x3c/0x1b0net_rx_action+0x27c/0x300 __do_softirq+0x114/0x2d2 irq_exit_rcu+0xb4/0xe0common_interrupt+0xba/0xe0 </IRQ> <TASK> The crash is caused by privatelytransferring waitqueue entries from smc socket->wq to clcsock->wq. Theowners of these entries, such as epoll, have no idea that the entries havebeen transferred to a different socket wait queue and still use originalwaitqueue spinlock (smc socket->wq.wait.lock) to make the entries operationexclusive, but it doesn't work. The operations to the entries, such asremoving from the waitqueue (now is clcsock->wq after fallback), may causea crash when clcsock waitqueue is being iterated over at the moment. Thispatch tries to fix this by no longer transferring wait queue entriesprivately, but introducing own implementations of clcsock's callbackfunctions in fallback situation. The callback functions will forward thewakeup to smc socket->wq if clcsock->wq is actually woken up and smcsocket->wq has remaining entries.\n\n    Update Instructions:\n\n    Run `sudo pro fix CVE-2022-48721` to fix the vulnerability. The problem can be corrected\n    by updating your system to the following package versions:\n\nlinux-image-6.5.0-9-generic - 6.5.0-9.9\nlinux-image-unsigned-6.5.0-9-generic - 6.5.0-9.9\nlinux-image-unsigned-6.5.0-9-generic-64k - 6.5.0-9.9\nNo subscription required\n\nlinux-image-unsigned-6.5.0-1008-aws - 6.5.0-1008.8\nNo subscription required\n\nlinux-image-unsigned-6.5.0-1007-azure - 6.5.0-1007.7\nNo subscription required\n\nlinux-image-unsigned-6.5.0-1007-gcp - 6.5.0-1007.7\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1003-gke - 6.8.0-1003.5\nNo subscription required\n\nlinux-image-unsigned-6.5.0-1009-ibm - 6.5.0-1009.9\nNo subscription required\n\nlinux-image-unsigned-6.5.0-9-lowlatency - 6.5.0-9.9.1\nlinux-image-unsigned-6.5.0-9-lowlatency-64k - 6.5.0-9.9.1\nNo subscription required\n\nlinux-image-unsigned-6.5.0-1010-oracle - 6.5.0-1010.10\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1003-oem - 6.8.0-1003.3\nNo subscription required\n\nlinux-image-6.5.0-1005-raspi - 6.5.0-1005.7\nNo subscription required\n\nlinux-image-unsigned-6.8.0-1005-intel - 6.8.0-1001.6\nNo subscription required\n\nlinux-image-6.7.0-2001-raspi-realtime - 6.7.0-2001.1\nAvailable with Ubuntu Pro: https://ubuntu.com/pro\n\nlinux-image-unsigned-6.8.0-1008-realtime - 6.8.0-1008.19\nAvailable with Ubuntu Pro: https://ubuntu.com/pro",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 24.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2022-48721",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2022-48721"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-06-20 11:15:00 UTC",
			"cve": {
				"text": "CVE-2022-48721",
				"href": "https://ubuntu.com/security/CVE-2022-48721",
				"public": "20240620"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000000",
						"comment": "linux package in noble, is related to the CVE in some way and has been fixed (note: '6.5.0-9.9')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000010",
						"comment": "linux-aws package in noble, is related to the CVE in some way and has been fixed (note: '6.5.0-1008.8')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000030",
						"comment": "linux-azure package in noble, is related to the CVE in some way and has been fixed (note: '6.5.0-1007.7')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000030",
						"comment": "linux-gcp package in noble, is related to the CVE in some way and has been fixed (note: '6.5.0-1007.7')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000020",
						"comment": "linux-gke package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1003.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000040",
						"comment": "linux-ibm package in noble, is related to the CVE in some way and has been fixed (note: '6.5.0-1009.9')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000060",
						"comment": "linux-lowlatency package in noble, is related to the CVE in some way and has been fixed (note: '6.5.0-9.9.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000070",
						"comment": "linux-oracle package in noble, is related to the CVE in some way and has been fixed (note: '6.5.0-1010.10')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000080",
						"comment": "linux-oem-6.8 package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1003.3')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000090",
						"comment": "linux-raspi package in noble, is related to the CVE in some way and has been fixed (note: '6.5.0-1005.7')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000050",
						"comment": "linux-intel package in noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1001.6')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000100",
						"comment": "linux-raspi-realtime package in realtime/noble, is related to the CVE in some way and has been fixed (note: '6.7.0-2001.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.noble:tst:201499000000110",
						"comment": "linux-realtime package in realtime/noble, is related to the CVE in some way and has been fixed (note: '6.8.0-1008.19')."
					}
				]
			}
		]
	}
}

{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.jammy:def:2024565590000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-56559 on Ubuntu 22.04 LTS for NVIDIA BlueField (jammy) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:mm/vmalloc: combine all TLB flush operations of KASAN shadow virtualaddress into one operationWhen compiling kernel source 'make -j $(nproc)' with the up-and-runningKASAN-enabled kernel on a 256-core machine, the following soft lockup isshown:watchdog: BUG: soft lockup - CPU#28 stuck for 22s! [kworker/28:1:1760]CPU: 28 PID: 1760 Comm: kworker/28:1 Kdump: loaded Not tainted 6.10.0-rc5#95Workqueue: events drain_vmap_area_workRIP: 0010:smp_call_function_many_cond+0x1d8/0xbb0Code: 38 c8 7c 08 84 c9 0f 85 49 08 00 00 8b 45 08 a8 01 74 2e 48 89 f1 4989 f7 48 c1 e9 03 41 83 e7 07 4c 01 e9 41 83 c7 03 f3 90 <0f> b6 01 41 38c7 7c 08 84 c0 0f 85 d4 06 00 00 8b 45 08 a8 01 75RSP: 0018:ffffc9000cb3fb60 EFLAGS: 00000202RAX: 0000000000000011 RBX: ffff8883bc4469c0 RCX: ffffed10776e9949RDX: 0000000000000002 RSI: ffff8883bb74ca48 RDI: ffffffff8434dc50RBP: ffff8883bb74ca40 R08: ffff888103585dc0 R09: ffff8884533a1800R10: 0000000000000004 R11: ffffffffffffffff R12: ffffed1077888d39R13: dffffc0000000000 R14: ffffed1077888d38 R15: 0000000000000003FS:  0000000000000000(0000) GS:ffff8883bc400000(0000)knlGS:0000000000000000CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033CR2: 00005577b5c8d158 CR3: 0000000004850000 CR4: 0000000000350ef0Call Trace: <IRQ> ? watchdog_timer_fn+0x2cd/0x390 ? __pfx_watchdog_timer_fn+0x10/0x10 ? __hrtimer_run_queues+0x300/0x6d0 ? sched_clock_cpu+0x69/0x4e0 ? __pfx___hrtimer_run_queues+0x10/0x10 ? srso_return_thunk+0x5/0x5f ? ktime_get_update_offsets_now+0x7f/0x2a0 ? srso_return_thunk+0x5/0x5f ? srso_return_thunk+0x5/0x5f ? hrtimer_interrupt+0x2ca/0x760 ? __sysvec_apic_timer_interrupt+0x8c/0x2b0 ? sysvec_apic_timer_interrupt+0x6a/0x90 </IRQ> <TASK> ? asm_sysvec_apic_timer_interrupt+0x16/0x20 ? smp_call_function_many_cond+0x1d8/0xbb0 ? __pfx_do_kernel_range_flush+0x10/0x10 on_each_cpu_cond_mask+0x20/0x40 flush_tlb_kernel_range+0x19b/0x250 ? srso_return_thunk+0x5/0x5f ? kasan_release_vmalloc+0xa7/0xc0 purge_vmap_node+0x357/0x820 ? __pfx_purge_vmap_node+0x10/0x10 __purge_vmap_area_lazy+0x5b8/0xa10 drain_vmap_area_work+0x21/0x30 process_one_work+0x661/0x10b0 worker_thread+0x844/0x10e0 ? srso_return_thunk+0x5/0x5f ? __kthread_parkme+0x82/0x140 ? __pfx_worker_thread+0x10/0x10 kthread+0x2a5/0x370 ? __pfx_kthread+0x10/0x10 ret_from_fork+0x30/0x70 ? __pfx_kthread+0x10/0x10 ret_from_fork_asm+0x1a/0x30 </TASK>Debugging Analysis:  1. The following ftrace log shows that the lockup CPU spends too much     time iterating vmap_nodes and flushing TLB when purging vm_area     structures. (Some info is trimmed).     kworker: funcgraph_entry:              |  drain_vmap_area_work() {     kworker: funcgraph_entry:              |   mutex_lock() {     kworker: funcgraph_entry:  1.092 us    |     __cond_resched();     kworker: funcgraph_exit:   3.306 us    |   }     ...                                        ...     kworker: funcgraph_entry:              |    flush_tlb_kernel_range() {     ...                                          ...     kworker: funcgraph_exit: # 7533.649 us |    }     ...                                         ...     kworker: funcgraph_entry:  2.344 us    |   mutex_unlock();     kworker: funcgraph_exit: $ 23871554 us | }     The drain_vmap_area_work() spends over 23 seconds.     There are 2805 flush_tlb_kernel_range() calls in the ftrace log.       * One is called in __purge_vmap_area_lazy().       * Others are called by purge_vmap_node->kasan_release_vmalloc.         purge_vmap_node() iteratively releases kasan vmalloc         allocations and flushes TLB for each vmap_area.           - [Rough calculation] Each flush_tlb_kernel_range() runs             about 7.5ms.               -- 2804 * 7.5ms = 21.03 seconds.               -- That's why a soft lock is triggered.  2. Extending the soft lockup time can work around the issue (For example,     # echo---truncated---",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 22.04 LTS for NVIDIA BlueField"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-56559",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2024-56559"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-12-27 15:15:00 UTC",
			"cve": {
				"text": "CVE-2024-56559",
				"href": "https://ubuntu.com/security/CVE-2024-56559",
				"public": "20241227"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000000",
						"comment": "linux package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000170",
						"comment": "linux-hwe-5.19: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-6.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000280",
						"comment": "linux-hwe-6.2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-6.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000360",
						"comment": "linux-hwe-6.5: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-hwe-6.8')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000050",
						"comment": "linux-kvm package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000250",
						"comment": "linux-allwinner-5.19: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000010",
						"comment": "linux-aws package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000230",
						"comment": "linux-aws-5.19: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-6.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000270",
						"comment": "linux-aws-6.2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-6.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000390",
						"comment": "linux-aws-6.5: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-aws-6.8')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000030",
						"comment": "linux-azure package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000190",
						"comment": "linux-azure-5.19: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-6.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000310",
						"comment": "linux-azure-6.2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-6.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000400",
						"comment": "linux-azure-6.5: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-6.8')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000110",
						"comment": "linux-azure-fde package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000200",
						"comment": "linux-azure-fde-5.19: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-azure-fde-6.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000320",
						"comment": "linux-azure-fde-6.2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'replaced by linux-azure-6.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000090",
						"comment": "linux-bluefield package in bluefield/jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000040",
						"comment": "linux-gcp package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000240",
						"comment": "linux-gcp-5.19: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-6.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000300",
						"comment": "linux-gcp-6.2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-6.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000410",
						"comment": "linux-gcp-6.5: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-gcp-6.8')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000020",
						"comment": "linux-gke package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000080",
						"comment": "linux-gkeop package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000100",
						"comment": "linux-ibm package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000140",
						"comment": "linux-intel-iotg package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000120",
						"comment": "linux-lowlatency package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000180",
						"comment": "linux-lowlatency-hwe-5.19: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-lowlatency-hwe-6.2')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000290",
						"comment": "linux-lowlatency-hwe-6.2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-lowlatency-hwe-6.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000370",
						"comment": "linux-lowlatency-hwe-6.5: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-lowlatency-hwe-6.8')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000220",
						"comment": "linux-nvidia package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000330",
						"comment": "linux-nvidia-6.2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-nvidia-6.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000430",
						"comment": "linux-nvidia-6.5: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-nvidia-6.8')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000060",
						"comment": "linux-oracle package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000420",
						"comment": "linux-oracle-6.5: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oracle-6.8')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000130",
						"comment": "linux-oem-5.17: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-6.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000150",
						"comment": "linux-oem-6.0: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-6.1')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000160",
						"comment": "linux-oem-6.1: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-6.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000350",
						"comment": "linux-oem-6.5: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-oem-6.8')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000070",
						"comment": "linux-raspi package in jammy is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000440",
						"comment": "linux-realtime: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by Ubuntu Pro ppa version')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000260",
						"comment": "linux-starfive-5.19: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000340",
						"comment": "linux-starfive-6.2: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'superseded by linux-starfive-6.5')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000380",
						"comment": "linux-starfive-6.5: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'end of kernel support')."
					},
					{
						"test_ref": "oval:com.ubuntu.jammy:tst:201245420000210",
						"comment": "linux-xilinx-zynqmp package in jammy is affected and may need fixing."
					}
				]
			}
		]
	}
}

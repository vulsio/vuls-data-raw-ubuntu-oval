{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.trusty:def:2024531020000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-53102 on Ubuntu 14.04 LTS (trusty) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:nvme: make keep-alive synchronous operationThe nvme keep-alive operation, which executes at a periodic interval,could potentially sneak in while shutting down a fabric controller.This may lead to a race between the fabric controller admin queuedestroy code path (invoked while shutting down controller) and hw/hctxqueue dispatcher called from the nvme keep-alive async request queuingoperation. This race could lead to the kernel crash shown below:Call Trace:    autoremove_wake_function+0x0/0xbc (unreliable)    __blk_mq_sched_dispatch_requests+0x114/0x24c    blk_mq_sched_dispatch_requests+0x44/0x84    blk_mq_run_hw_queue+0x140/0x220    nvme_keep_alive_work+0xc8/0x19c [nvme_core]    process_one_work+0x200/0x4e0    worker_thread+0x340/0x504    kthread+0x138/0x140    start_kernel_thread+0x14/0x18While shutting down fabric controller, if nvme keep-alive request sneaksin then it would be flushed off. The nvme_keep_alive_end_io function isthen invoked to handle the end of the keep-alive operation whichdecrements the admin->q_usage_counter and assuming this is the last/onlyrequest in the admin queue then the admin->q_usage_counter becomes zero.If that happens then blk-mq destroy queue operation (blk_mq_destroy_queue()) which could be potentially running simultaneously on anothercpu (as this is the controller shutdown code path) would forwardprogress and deletes the admin queue. So, now from this point onwardwe are not supposed to access the admin queue resources. However theissue here's that the nvme keep-alive thread running hw/hctx queuedispatch operation hasn't yet finished its work and so it could stillpotentially access the admin queue resource while the admin queue hadbeen already deleted and that causes the above crash.This fix helps avoid the observed crash by implementing keep-alive as asynchronous operation so that we decrement admin->q_usage_counter onlyafter keep-alive command finished its execution and returns the commandstatus back up to its caller (blk_execute_rq()). This would ensure thatfabric shutdown code path doesn't destroy the fabric admin queue untilkeep-alive request finished execution and also keep-alive thread is notrunning hw/hctx queue dispatch operation.",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 14.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-53102",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2024-53102"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-11-25 22:15:00 UTC",
			"cve": {
				"text": "CVE-2024-53102",
				"href": "https://ubuntu.com/security/CVE-2024-53102",
				"public": "20241125"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000000",
						"comment": "linux: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'ESM criteria, was needed')."
					},
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000010",
						"comment": "linux-lts-xenial: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'ESM criteria, was needed')."
					},
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000020",
						"comment": "linux-aws: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'ESM criteria, was needed')."
					},
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000030",
						"comment": "linux-azure: while related to the CVE in some way, a decision has been made to ignore this issue (note: 'ESM criteria, was needed')."
					}
				]
			}
		]
	}
}

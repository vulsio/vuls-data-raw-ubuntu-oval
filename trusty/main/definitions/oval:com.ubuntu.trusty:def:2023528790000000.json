{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.trusty:def:2023528790000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2023-52879 on Ubuntu 14.04 LTS (trusty) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:tracing: Have trace_event_file have ref countersThe following can crash the kernel: # cd /sys/kernel/tracing # echo 'p:sched schedule' > kprobe_events # exec 5>>events/kprobes/sched/enable # > kprobe_events # exec 5>&-The above commands: 1. Change directory to the tracefs directory 2. Create a kprobe event (doesn't matter what one) 3. Open bash file descriptor 5 on the enable file of the kprobe event 4. Delete the kprobe event (removes the files too) 5. Close the bash file descriptor 5The above causes a crash! BUG: kernel NULL pointer dereference, address: 0000000000000028 #PF: supervisor read access in kernel mode #PF: error_code(0x0000) - not-present page PGD 0 P4D 0 Oops: 0000 [#1] PREEMPT SMP PTI CPU: 6 PID: 877 Comm: bash Not tainted6.5.0-rc4-test-00008-g2c6b6b1029d4-dirty #186 Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS1.16.2-debian-1.16.2-1 04/01/2014 RIP: 0010:tracing_release_file_tr+0xc/0x50What happens here is that the kprobe event creates a trace_event_file\"file\" descriptor that represents the file in tracefs to the event. Itmaintains state of the event (is it enabled for the given instance?).Opening the \"enable\" file gets a reference to the event \"file\" descriptorvia the open file descriptor. When the kprobe event is deleted, the file isalso deleted from the tracefs system which also frees the event \"file\"descriptor.But as the tracefs file is still opened by user space, it will not betotally removed until the final dput() is called on it. But this is nottrue with the event \"file\" descriptor that is already freed. If the userdoes a write to or simply closes the file descriptor it will reference theevent \"file\" descriptor that was just freed, causing a use-after-free bug.To solve this, add a ref count to the event \"file\" descriptor as well as anew flag called \"FREED\". The \"file\" will not be freed until the lastreference is released. But the FREE flag will be set when the event isremoved to prevent any more modifications to that event from happening,even if there's still a reference to the event \"file\" descriptor.",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 14.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2023-52879",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2023-52879"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-05-21 16:15:00 UTC",
			"cve": {
				"text": "CVE-2023-52879",
				"href": "https://ubuntu.com/security/CVE-2023-52879",
				"public": "20240521"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000000",
						"comment": "linux package in trusty is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000010",
						"comment": "linux-lts-xenial package in trusty is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000020",
						"comment": "linux-aws package in trusty is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000030",
						"comment": "linux-azure package in trusty is affected and may need fixing."
					}
				]
			}
		]
	}
}

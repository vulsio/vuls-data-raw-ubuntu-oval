{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.trusty:def:2021471920000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2021-47192 on Ubuntu 14.04 LTS (trusty) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:scsi: core: sysfs: Fix hang when device state is set via sysfsThis fixes a regression added with:commit f0f82e2476f6 (\"scsi: core: Fix capacity set to zero afterofflinining device\")The problem is that after iSCSI recovery, iscsid will call into the kernelto set the dev's state to running, and with that patch we now callscsi_rescan_device() with the state_mutex held. If the SCSI error handlerthread is just starting to test the device in scsi_send_eh_cmnd() then it'sgoing to try to grab the state_mutex.We are then stuck, because when scsi_rescan_device() tries to send its I/Oscsi_queue_rq() calls -> scsi_host_queue_ready() -> scsi_host_in_recovery()which will return true (the host state is still in recovery) and I/O willjust be requeued. scsi_send_eh_cmnd() will then never be able to grab thestate_mutex to finish error handling.To prevent the deadlock move the rescan-related code to after we drop thestate_mutex.This also adds a check for if we are already in the running state. Thisprevents extra scans and helps the iscsid case where if the transport classhas already onlined the device during its recovery process then we don'tneed userspace to do it again plus possibly block that daemon.",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 14.04 LTS"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2021-47192",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2021-47192"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2024 Canonical Ltd.",
			"public_date": "2024-04-11",
			"cve": {
				"text": "CVE-2021-47192",
				"href": "https://ubuntu.com/security/CVE-2021-47192",
				"public": "20240411"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000000",
						"comment": "linux package in trusty is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000010",
						"comment": "linux-lts-xenial package in trusty is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000020",
						"comment": "linux-aws package in trusty is affected and may need fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.trusty:tst:200747740000030",
						"comment": "linux-azure package in trusty is affected and may need fixing."
					}
				]
			}
		]
	}
}

{
	"class": "vulnerability",
	"id": "oval:com.ubuntu.oracular:def:2024556420000000",
	"version": "1",
	"metadata": {
		"title": "CVE-2024-55642 on Ubuntu 24.10 (oracular) - medium",
		"description": "In the Linux kernel, the following vulnerability has been resolved:block: Prevent potential deadlocks in zone write plug error recoveryZone write plugging for handling writes to zones of a zoned blockdevice always execute a zone report whenever a write BIO to a zonefails. The intent of this is to ensure that the tracking of a zone writepointer is always correct to ensure that the alignment to a zone writepointer of write BIOs can be checked on submission and that we canalways correctly emulate zone append operations using regular writeBIOs.However, this error recovery scheme introduces a potential deadlock if adevice queue freeze is initiated while BIOs are still plugged in a zonewrite plug and one of these write operation fails. In such case, thedisk zone write plug error recovery work is scheduled and executes areport zone. This in turn can result in a request allocation in theunderlying driver to issue the report zones command to the device. Butwith the device queue freeze already started, this allocation willblock, preventing the report zone execution and the continuation of theprocessing of the plugged BIOs. As plugged BIOs hold a queue usagereference, the queue freeze itself will never complete, resulting in adeadlock.Avoid this problem by completely removing from the zone write pluggingcode the use of report zones operations after a failed write operation,instead relying on the device user to either execute a report zones,reset the zone, finish the zone, or give up writing to the device (whichis a fairly common pattern for file systems which degrade to read-onlyafter write failures). This is not an unreasonnable requirement as allwell-behaved applications, FSes and device mapper already use reportzones to recover from write errors whenever possible by comparing thecurrent position of a zone write pointer with what their assumptionabout the position is.The changes to remove the automatic error recovery are as follows: - Completely remove the error recovery work and its associated   resources (zone write plug list head, disk error list, and disk   zone_wplugs_work work struct). This also removes the functions   disk_zone_wplug_set_error() and disk_zone_wplug_clear_error(). - Change the BLK_ZONE_WPLUG_ERROR zone write plug flag into   BLK_ZONE_WPLUG_NEED_WP_UPDATE. This new flag is set for a zone write   plug whenever a write opration targetting the zone of the zone write   plug fails. This flag indicates that the zone write pointer offset is   not reliable and that it must be updated when the next report zone,   reset zone, finish zone or disk revalidation is executed. - Modify blk_zone_write_plug_bio_endio() to set the   BLK_ZONE_WPLUG_NEED_WP_UPDATE flag for the target zone of a failed   write BIO. - Modify the function disk_zone_wplug_set_wp_offset() to clear this   new flag, thus implementing recovery of a correct write pointer   offset with the reset (all) zone and finish zone operations. - Modify blkdev_report_zones() to always use the disk_report_zones_cb()   callback so that disk_zone_wplug_sync_wp_offset() can be called for   any zone marked with the BLK_ZONE_WPLUG_NEED_WP_UPDATE flag.   This implements recovery of a correct write pointer offset for zone   write plugs marked with BLK_ZONE_WPLUG_NEED_WP_UPDATE and within   the range of the report zones operation executed by the user. - Modify blk_revalidate_seq_zone() to call   disk_zone_wplug_sync_wp_offset() for all sequential write required   zones when a zoned block device is revalidated, thus always resolving   any inconsistency between the write pointer offset of zone write   plugs and the actual write pointer position of sequential zones.",
		"affected": {
			"family": "unix",
			"platform": "Ubuntu 24.10"
		},
		"reference": {
			"source": "CVE",
			"ref_id": "CVE-2024-55642",
			"ref_url": "https://www.cve.org/CVERecord?id=CVE-2024-55642"
		},
		"advisory": {
			"severity": "Medium",
			"rights": "Copyright (C) 2025 Canonical Ltd.",
			"public_date": "2025-01-11 13:15:00 UTC",
			"cve": {
				"text": "CVE-2024-55642",
				"href": "https://ubuntu.com/security/CVE-2024-55642",
				"public": "20250111",
				"cvss_score": "5.5",
				"cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H"
			}
		}
	},
	"notes": {},
	"criteria": {
		"criterias": [
			{
				"operator": "OR",
				"criterions": [
					{
						"test_ref": "oval:com.ubuntu.oracular:tst:201245420000000",
						"comment": "linux package in oracular is affected. An update containing the fix has been completed and is pending publication (note: '6.11.0-20.20')."
					},
					{
						"test_ref": "oval:com.ubuntu.oracular:tst:201245420000010",
						"comment": "linux-aws package in oracular is affected and needs fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.oracular:tst:201245420000020",
						"comment": "linux-azure package in oracular is affected and needs fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.oracular:tst:201245420000030",
						"comment": "linux-gcp package in oracular is affected and needs fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.oracular:tst:201245420000060",
						"comment": "linux-lowlatency package in oracular is affected and needs fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.oracular:tst:201245420000040",
						"comment": "linux-oracle package in oracular is affected and needs fixing."
					},
					{
						"test_ref": "oval:com.ubuntu.oracular:tst:201245420000050",
						"comment": "linux-raspi package in oracular is affected and needs fixing."
					}
				]
			}
		]
	}
}
